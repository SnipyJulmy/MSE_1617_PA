@import klughdl.core.KlugHDLModel
@(model: KlugHDLModel)

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>KlugHDL</title>
        <script src="lib/draw2d/lib/jquery-1.12.0.min.js"></script>
        <script src="lib/draw2d/lib/jquery.autoresize.js"></script>
        <script src="lib/draw2d/lib/jquery.contextmenu.js"></script>
        <script src="lib/draw2d/lib/jquery-touch_punch.js"></script>

        <script src="lib/draw2d/lib/canvg.js"></script>
        <script src="lib/draw2d/lib/Class.js"></script>
        <script src="lib/draw2d/lib/json2.js"></script>
        <script src="lib/draw2d/lib/pathfinding-browser.min.js"></script>
        <script src="lib/draw2d/lib/raphael.js"></script>
        <script src="lib/draw2d/lib/rgbcolor.js"></script>
        <script src="lib/draw2d/lib/shifty.js"></script>
        <script src="lib/draw2d/lib/StackBlur.js"></script>
        <script src="lib/draw2d/src/draw2d.js"></script>
        <script src="src/ComponentShape.js"></script>
        <script src="lib/graphlib/graphlib.min.js"></script>
        <script src="lib/dagre/dagre.js"></script>
    </head>
    <body>
            <!--suppress CssUnknownProperty -->
        <div id="gfx_holder1" style="width: 3000px;
            height: 3000px;"></div>
    </body>

    <script>

            $(document).ready(function () {

                // Init graph
                var g = new dagre.graphlib.Graph();
                g.setGraph({});
                g.setDefaultEdgeLabel(function () {
                    return {};
                });

                // generate all node
                @model.getKlugHDLComponents.map{ c =>
                g.setNode(@Html(c.idStr), {label: "", width: 100, height: 100});
                }

                // generate all edges
                // TODO

                dagre.layout(g);

                g.nodes().forEach(function (v) {
                    console.log("Node " + v + ": " + JSON.stringify(g.node(v)));
                });

                var canvas = new draw2d.Canvas("gfx_holder1");

                canvas.installEditPolicy(new draw2d.policy.connection.DragConnectionCreatePolicy({
                    createConnection: createConnection
                }));

                @model.getKlugHDLComponents.map{ c =>
                @Html(c.toJs)
                }

            });

            function createConnection() {
                var con = new draw2d.Connection();
                con.setRouter(new draw2d.layout.connection.ManhattanBridgedConnectionRouter());
                return con;
            }

            function newConnection(srcPort, targetPort) {
                var c = createConnection();
                c.setSource(srcPort);
                c.setTarget(targetPort);
                return c
            }

    </script>
</html>
