@import klughdl.core.old.KlugHDLModel
@@import klughdl.core.old.KlugHDLModel
(model: KlugHDLModel)

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>KlugHDL</title>
            <!--suppress HtmlUnknownTarget -->
        <script src="lib/draw2d/lib/jquery-1.12.0.min.js"></script>
            <!--suppress HtmlUnknownTarget -->
        <script src="lib/draw2d/lib/jquery.autoresize.js"></script>
            <!--suppress HtmlUnknownTarget -->
        <script src="lib/draw2d/lib/jquery.contextmenu.js"></script>
            <!--suppress HtmlUnknownTarget -->
        <script src="lib/draw2d/lib/jquery-touch_punch.js"></script>

            <!--suppress HtmlUnknownTarget -->
        <script src="lib/draw2d/lib/canvg.js"></script>
            <!--suppress HtmlUnknownTarget -->
        <script src="lib/draw2d/lib/Class.js"></script>
            <!--suppress HtmlUnknownTarget -->
        <script src="lib/draw2d/lib/json2.js"></script>
            <!--suppress HtmlUnknownTarget -->
        <script src="lib/draw2d/lib/pathfinding-browser.min.js"></script>
            <!--suppress HtmlUnknownTarget -->
        <script src="lib/draw2d/lib/raphael.js"></script>
            <!--suppress HtmlUnknownTarget -->
        <script src="lib/draw2d/lib/rgbcolor.js"></script>
            <!--suppress HtmlUnknownTarget -->
        <script src="lib/draw2d/lib/shifty.js"></script>
            <!--suppress HtmlUnknownTarget -->
        <script src="lib/draw2d/lib/StackBlur.js"></script>
            <!--suppress HtmlUnknownTarget -->
        <script src="lib/draw2d/src/draw2d.js"></script>
            <!--suppress HtmlUnknownTarget -->
        <script src="src/ComponentShape.js"></script>
            <!--suppress HtmlUnknownTarget -->
        <script src="lib/graphlib/graphlib.min.js"></script>
            <!--suppress HtmlUnknownTarget -->
        <script src="lib/dagre/dagre.js"></script>
    </head>
    <body>
        <div id="gfx_holder1" style="width: 3000px;
            height: 3000px;"></div>
    </body>

        <!--suppress JSUnusedLocalSymbols -->
    <script>

            $(document).ready(function () {

                // Init graph
                var g = new dagre.graphlib.Graph();
                g.setGraph({});
                g.setDefaultEdgeLabel(function () {
                    return {};
                });

                // generate all node
                @model.getKlugHDLComponents.map{ c =>
                g.setNode(@Html(c.idStr), {label: "", width: 200, height: 200});
                }

                // generate all edges for the layout
                @Html(model.connectionToJsLayout)

                dagre.layout(g);

                var canvas = new draw2d.Canvas("gfx_holder1");

                canvas.installEditPolicy(new draw2d.policy.connection.DragConnectionCreatePolicy({
                    createConnection: createConnection
                }));

                @model.getKlugHDLComponents.map{ c =>
                @Html(c.toJs)
                }

                // generate connection
                @Html(model.connectionToJs)

            });

            function createConnection() {
                var con = new draw2d.Connection();
                con.setRouter(new draw2d.layout.connection.InteractiveManhattanConnectionRouter());
                con.setTargetDecorator(new draw2d.decoration.connection.ArrowDecorator());
                return con;
            }

            function newConnection(srcPort, targetPort) {
                var c = createConnection();
                c.setSource(srcPort);
                c.setTarget(targetPort);
                return c
            }

    </script>
</html>
