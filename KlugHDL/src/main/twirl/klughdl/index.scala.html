@(title : String = "KluHDL")
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>@title</title>
        <script src="lib/draw2d/lib/jquery-1.12.0.min.js"></script>
        <script src="lib/draw2d/lib/jquery.autoresize.js"></script>
        <script src="lib/draw2d/lib/jquery.contextmenu.js"></script>
        <script src="lib/draw2d/lib/jquery-touch_punch.js"></script>

        <script src="lib/draw2d/lib/canvg.js"></script>
        <script src="lib/draw2d/lib/Class.js"></script>
        <script src="lib/draw2d/lib/json2.js"></script>
        <script src="lib/draw2d/lib/pathfinding-browser.min.js"></script>
        <script src="lib/draw2d/lib/raphael.js"></script>
        <script src="lib/draw2d/lib/rgbcolor.js"></script>
        <script src="lib/draw2d/lib/shifty.js"></script>
        <script src="lib/draw2d/lib/StackBlur.js"></script>
        <script src="lib/draw2d/src/draw2d.js"></script>
        <script src="src/ComponentShape.js"></script>
        <script src="lib/graphlib/graphlib.min.js"></script>
        <script src="lib/dagre/dagre.js"></script>
    </head>
    <body>
        <div id="gfx_holder1" style="
            width: 1000px;
            height: 1000px;
        "></div>
    </body>

    <script>

            $(document).ready(function () {

                var g = new dagre.graphlib.Graph();
                g.setGraph({});

                g.setDefaultEdgeLabel(function () {
                    return {};
                });

                g.setNode("I", {label: "", width: 100, height: 100});
                g.setNode("O", {label: "", width: 100, height: 100});
                g.setNode("a", {label: "", width: 100, height: 100});
                g.setNode("o", {label: "", width: 100, height: 100});
                g.setEdge("I", "a");
                g.setEdge("I", "a");
                g.setEdge("I", "o");
                g.setEdge("I", "o");
                g.setEdge("a", "O");
                g.setEdge("o", "O");

                dagre.layout(g);

                var canvas = new draw2d.Canvas("gfx_holder1");

                var andGate = new ComponentShape();
                var orGate = new ComponentShape();
                var input = new ComponentShape();
                var output = new ComponentShape();

                canvas.installEditPolicy(new draw2d.policy.connection.DragConnectionCreatePolicy({
                    createConnection: createConnection
                }));

                andGate.setName("AndGate");
                orGate.setName("OrGate");
                input.setName("Input");
                output.setName("Output");

                andGate.addPort("io.a", "input");
                andGate.addPort("io.b", "input");
                andGate.addPort("io.c", "output");

                orGate.addPort("io.a", "input");
                orGate.addPort("io.b", "input");
                orGate.addPort("io.c", "output");

                input.addPort("io.a", "output");
                input.addPort("io.b", "output");

                output.addPort("io.c", "input");

                input.setX(g.node("I").x);
                input.setY(g.node("I").y);
                output.setX(g.node("O").x);
                output.setY(g.node("O").y);
                andGate.setX(g.node("a").x);
                andGate.setY(g.node("a").y);
                orGate.setX(g.node("o").x);
                orGate.setY(g.node("o").y);

                canvas.add(input);
                canvas.add(output);
                canvas.add(andGate);
                canvas.add(orGate);

                // TODO layout the edges ?
                var c = newConnection(input.getPort("io.a"), andGate.getPort("io.a"));
                canvas.add(c);
                canvas.add(newConnection(input.getPort("io.b"), andGate.getPort("io.b")));
                canvas.add(newConnection(input.getPort("io.a"), orGate.getPort("io.a")));
                canvas.add(newConnection(input.getPort("io.b"), orGate.getPort("io.b")));

                canvas.add(newConnection(andGate.getPort("io.c"), output.getPort("io.c")));
                canvas.add(newConnection(orGate.getPort("io.c"), output.getPort("io.c")));
            });

            function createConnection() {
                var con = new draw2d.Connection();
                con.setRouter(new draw2d.layout.connection.ManhattanBridgedConnectionRouter());
                return con;
            }

            function newConnection(srcPort, targetPort) {
                var c = createConnection();
                c.setSource(srcPort);
                c.setTarget(targetPort);
                return c
            }

    </script>
</html>